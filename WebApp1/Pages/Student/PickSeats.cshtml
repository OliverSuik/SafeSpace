@page
@model WebApp1.Pages.Student.PickSeatsModel
@{
    ViewData["Title"] = "Book a seat";
    String _backGroundImage = "https://eu-central-1.linodeobjects.com/wemply/abb/public/55ef77ff25714b63844cf34590d835ac.4.svg";
}
<div class="mb-3">
    <h1>Book a seat</h1>
    <h5>@Model.SessionTitle</h5>
    <p>Your seat: @(Model.ConfirmedSeat == null ? "" : Model.ConfirmedSeat.ID)</p>

    <div class="row m-0">
        @if (Model.SelectedSeat == null)
        {
            <button type="button" class="btn btn-outline-primary" disabled>
                Confirm
            </button>
        }
        else
        {
            <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#exampleModal">
                Confirm
            </button>
        }
        @if (Model.ConfirmedSeat != null)
        {
            <button type="button" class="btn btn-outline-dark ml-3" data-toggle="modal" data-target="#exampleModal2">
                Cancel reservation
            </button>
        }
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Confirm your choice</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    @if (Model.ConfirmedSeat == null)
                    {
                        <p>
                            Are you sure you want to book this seat?
                        </p>
                    }
                    else
                    {
                        <p>
                            Are you sure you want to change your seat?
                        </p>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <form method="post" class="mb-3">
                        <div class="form-group">
                            <input type="hidden" asp-for="SelectedSeat.ID" value=@Model.SelectedSeatId class="form-control" />
                        </div>
                        <input type="submit" value="Save" class="btn btn-primary" />
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Cancel reservation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to cancel your reservation?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <form method="post" class="mb-3">
                        <div class="form-group">
                            <input type="hidden" asp-for="SelectedSeat.ID" value=-1 class="form-control" />
                        </div>
                        <input type="submit" value="Confirm" class="btn btn-primary" />
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="image-container">
    @if (_backGroundImage == null)
    {
        <p class="">Loading...</p>
    }
    else
    {
        <div class="floor-image" style="background-image: url(@_backGroundImage)" />
        @foreach (var seat in Model.Seats)
        {
            var routeValues = new Dictionary<string, string>
{
                { "seatId", seat.ID.ToString() },
                { "id", Model.SessNr.ToString() }
                };
            @if (seat.User.Name == "-")
            {
                <a asp-page="PickSeats" asp-all-route-data="routeValues" class="@((seat.ID == Model.SelectedSeatId ? "square-selected" : "square" ))"
                   id="square-@seat.ID" style="left: @(seat.X - 395)px; top: @(seat.Y - 268)px">
                    @((seat.User.Name).Substring(0, 1).ToUpper())
                </a>
            }
            else
            {
                <div class="@((seat.User.Name == User.Identity.Name ? "square-confirmed-user" : "square-confirmed" ))"
                     id="square-@seat.ID" style="left: @(seat.X - 395)px; top: @(seat.Y - 268)px">
                    @((seat.User.Name).Substring(0, 1).ToUpper())
                </div>
            }

        }
    }
</div>
